#!/usr/bin/env node

/**
 * Script to update Supabase configuration with new project credentials
 * Usage: node update-supabase-config.js <project-url> <anon-key>
 * Example: node update-supabase-config.js https://abc123.supabase.co eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
 */

import fs from 'fs';
import path from 'path';

const args = process.argv.slice(2);

if (args.length !== 2) {
  console.log('‚ùå Usage: node update-supabase-config.js <project-url> <anon-key>');
  console.log('üìù Example: node update-supabase-config.js https://abc123.supabase.co eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...');
  process.exit(1);
}

const [projectUrl, anonKey] = args;

// Extract project ID from URL
const projectIdMatch = projectUrl.match(/https:\/\/([^.]+)\.supabase\.co/);
if (!projectIdMatch) {
  console.log('‚ùå Invalid project URL format. Expected: https://project-id.supabase.co');
  process.exit(1);
}

const projectId = projectIdMatch[1];

console.log('üîÑ Updating Supabase configuration...');
console.log(`üìå Project ID: ${projectId}`);
console.log(`üîó Project URL: ${projectUrl}`);

// Update info.tsx file
const infoPath = path.join(process.cwd(), 'src', 'utils', 'supabase', 'info.tsx');
const infoContent = `/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = "${projectId}"
export const publicAnonKey = "${anonKey}"`;

try {
  fs.writeFileSync(infoPath, infoContent);
  console.log('‚úÖ Updated src/utils/supabase/info.tsx');
} catch (error) {
  console.log('‚ùå Failed to update info.tsx:', error.message);
  process.exit(1);
}

// Create/update .env file
const envPath = path.join(process.cwd(), '.env');
const envContent = `# Supabase Configuration
VITE_SUPABASE_URL=${projectUrl}
VITE_SUPABASE_ANON_KEY=${anonKey}

# Local Supabase Configuration (uncomment to use local)
# VITE_SUPABASE_URL=http://localhost:54321
# VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0`;

try {
  fs.writeFileSync(envPath, envContent);
  console.log('‚úÖ Created/updated .env file');
} catch (error) {
  console.log('‚ùå Failed to update .env file:', error.message);
}

console.log('üéâ Supabase configuration updated successfully!');
console.log('üîÑ Restart your dev server: npm run dev');
console.log('üåê Your new Supabase project: ' + projectUrl.replace('https://', 'https://supabase.com/dashboard/project/'));
